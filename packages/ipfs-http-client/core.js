"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
async function some(ipfsClient, configs) {
    let ipfs;
    for (let argv of configs) {
        try {
            // @ts-ignore
            ipfs = ipfsClient(...argv);
            await ipfs.id();
            break;
        }
        catch (e) { }
    }
    return ipfs;
}
exports.some = some;
function use(ipfsHttpModule) {
    return async function ipfsClient(...argvs) {
        let [config, ...argv] = argvs;
        if (config == null) {
            let configs = [];
            if (typeof process !== 'undefined' && typeof process.env.IPFS_ADDRESSES_API === 'string') {
                configs.push([process.env.IPFS_ADDRESSES_API, ...argv]);
            }
            configs.push([{ port: '5001' }, ...argv]);
            configs.push([{ port: '5002' }, ...argv]);
            return some(ipfsHttpModule, configs);
        }
        return ipfsHttpModule(config, ...argv);
    };
}
exports.use = use;
exports.default = use;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFPTyxLQUFLLFVBQVUsSUFBSSxDQUFDLFVBQXlCLEVBQUUsT0FBZ0M7SUFFckYsSUFBSSxJQUF1QixDQUFDO0lBRTVCLEtBQUssSUFBSSxJQUFJLElBQUksT0FBTyxFQUN4QjtRQUNDLElBQ0E7WUFDQyxhQUFhO1lBQ2IsSUFBSSxHQUFHLFVBQVUsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1lBQzNCLE1BQU0sSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ2hCLE1BQU07U0FDTjtRQUNELE9BQU8sQ0FBQyxFQUNSLEdBQUU7S0FDRjtJQUVELE9BQU8sSUFBSSxDQUFBO0FBQ1osQ0FBQztBQWxCRCxvQkFrQkM7QUFFRCxTQUFnQixHQUFHLENBQUMsY0FBNkI7SUFFaEQsT0FBTyxLQUFLLFVBQVUsVUFBVSxDQUFDLEdBQUcsS0FBNEI7UUFFL0QsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUU5QixJQUFJLE1BQU0sSUFBSSxJQUFJLEVBQ2xCO1lBQ0MsSUFBSSxPQUFPLEdBQXlDLEVBQUUsQ0FBQztZQUV2RCxJQUFJLE9BQU8sT0FBTyxLQUFLLFdBQVcsSUFBSSxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEtBQUssUUFBUSxFQUN4RjtnQkFDQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7YUFDeEQ7WUFFRCxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQzFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7WUFFMUMsT0FBTyxJQUFJLENBQUMsY0FBYyxFQUFFLE9BQU8sQ0FBQyxDQUFBO1NBQ3BDO1FBRUQsT0FBTyxjQUFjLENBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUE7SUFDdkMsQ0FBQyxDQUFBO0FBQ0YsQ0FBQztBQXZCRCxrQkF1QkM7QUFFRCxrQkFBZSxHQUFHLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgX2lwZnNIdHRwTW9kdWxlIGZyb20gJ2lwZnMtaHR0cC1jbGllbnQnXG5cbmV4cG9ydCB0eXBlIElJUEZTQ2xpZW50UGFyYW1ldGVycyA9IFBhcmFtZXRlcnM8dHlwZW9mIF9pcGZzSHR0cE1vZHVsZT5cbmV4cG9ydCB0eXBlIElJUEZTQ2xpZW50UmV0dXJuID0gUmV0dXJuVHlwZTx0eXBlb2YgX2lwZnNIdHRwTW9kdWxlPlxuZXhwb3J0IHR5cGUgSUlQRlNDbGllbnRGbiA9ICguLi5hcmd2czogSUlQRlNDbGllbnRQYXJhbWV0ZXJzKSA9PiBJSVBGU0NsaWVudFJldHVyblxuZXhwb3J0IHR5cGUgSUlQRlNDbGllbnRGbldyYXAgPSAoLi4uYXJndnM6IElJUEZTQ2xpZW50UGFyYW1ldGVycykgPT4gUHJvbWlzZTxJSVBGU0NsaWVudFJldHVybj5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNvbWUoaXBmc0NsaWVudDogSUlQRlNDbGllbnRGbiwgY29uZmlnczogSUlQRlNDbGllbnRQYXJhbWV0ZXJzW10pOiBQcm9taXNlPElJUEZTQ2xpZW50UmV0dXJuPlxue1xuXHRsZXQgaXBmczogSUlQRlNDbGllbnRSZXR1cm47XG5cblx0Zm9yIChsZXQgYXJndiBvZiBjb25maWdzKVxuXHR7XG5cdFx0dHJ5XG5cdFx0e1xuXHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0aXBmcyA9IGlwZnNDbGllbnQoLi4uYXJndik7XG5cdFx0XHRhd2FpdCBpcGZzLmlkKCk7XG5cdFx0XHRicmVhaztcblx0XHR9XG5cdFx0Y2F0Y2ggKGUpXG5cdFx0e31cblx0fVxuXG5cdHJldHVybiBpcGZzXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2UoaXBmc0h0dHBNb2R1bGU6IElJUEZTQ2xpZW50Rm4pOiBJSVBGU0NsaWVudEZuV3JhcFxue1xuXHRyZXR1cm4gYXN5bmMgZnVuY3Rpb24gaXBmc0NsaWVudCguLi5hcmd2czogSUlQRlNDbGllbnRQYXJhbWV0ZXJzKTogUHJvbWlzZTxJSVBGU0NsaWVudFJldHVybj5cblx0e1xuXHRcdGxldCBbY29uZmlnLCAuLi5hcmd2XSA9IGFyZ3ZzO1xuXG5cdFx0aWYgKGNvbmZpZyA9PSBudWxsKVxuXHRcdHtcblx0XHRcdGxldCBjb25maWdzOiBQYXJhbWV0ZXJzPHR5cGVvZiBfaXBmc0h0dHBNb2R1bGU+W10gPSBbXTtcblxuXHRcdFx0aWYgKHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgcHJvY2Vzcy5lbnYuSVBGU19BRERSRVNTRVNfQVBJID09PSAnc3RyaW5nJylcblx0XHRcdHtcblx0XHRcdFx0Y29uZmlncy5wdXNoKFtwcm9jZXNzLmVudi5JUEZTX0FERFJFU1NFU19BUEksIC4uLmFyZ3ZdKTtcblx0XHRcdH1cblxuXHRcdFx0Y29uZmlncy5wdXNoKFt7IHBvcnQ6ICc1MDAxJyB9LCAuLi5hcmd2XSk7XG5cdFx0XHRjb25maWdzLnB1c2goW3sgcG9ydDogJzUwMDInIH0sIC4uLmFyZ3ZdKTtcblxuXHRcdFx0cmV0dXJuIHNvbWUoaXBmc0h0dHBNb2R1bGUsIGNvbmZpZ3MpXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGlwZnNIdHRwTW9kdWxlKGNvbmZpZywgLi4uYXJndilcblx0fVxufVxuXG5leHBvcnQgZGVmYXVsdCB1c2VcbiJdfQ==